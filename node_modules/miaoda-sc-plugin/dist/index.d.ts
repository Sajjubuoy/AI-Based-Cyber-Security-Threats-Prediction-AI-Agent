import * as vite from 'vite';
import { Plugin, PluginOption } from 'vite';

interface BorderStylePluginOptions {
    /**
     * 是否启用响应式变体
     * @default true
     */
    responsive?: boolean;
    /**
     * 自定义 CSS 选择器前缀
     * @default ''
     */
    prefix?: string;
}
declare function borderStylePlugin(options?: BorderStylePluginOptions): Plugin;

/**
 * @file vite-plugin-dynamic-redirect.ts
 *
 * @author allenve(yupeng12@baidu.com)
 * @created: 2025/08/04
 */

declare function dynamicRedirectPlugin(): Plugin;

declare function replaceLocationPlugin(): Plugin;

/**
 * @file vite-plugin-fonts-code.ts
 *
 * @author allenve(yupeng12@baidu.com)
 * @created: 2025/08/04
 */

interface FontsCodePluginOptions {
    href?: string;
    id?: string;
}
declare function fontsCodePlugin(options?: FontsCodePluginOptions): Plugin;

interface MdClickPluginOptions {
    appType?: string;
}
declare function mdClickPlugin(options?: MdClickPluginOptions): Plugin;

declare function injectOnErrorPlugin(): Plugin;

declare const extractRouterPlugin: () => {
    name: string;
    apply: string;
    enforce: string;
    configResolved(config: any): Promise<void>;
    buildStart(): void;
    transform(code: string, id: string): Promise<void>;
    configureServer(_server: any): void;
};

declare const extractTaroRouterPlugin: () => {
    name: string;
    enforce: string;
    buildStart(): void;
    transform(code: string, id: string): Promise<void>;
    configureServer(server: any): void;
};

/**
 * @file vite-plugin-inject-domain.ts
 *
 * @author allenve(yupeng12@baidu.com)
 * @created: 2025/08/15
 */

declare function injectDomainPlugin(domain: string): Plugin;

/**
 * @file vite-plugin-gui-listener.ts
 *
 * @author allenve(yupeng12@baidu.com)
 * @created: 2025/08/15
 */

declare function injectedGuiListenerPlugin(options?: {
    origin?: string;
    path?: string;
}): Plugin;

type TaggerOptions = {
  /**
   * 是否为原子组件路径，原子组件路径不加标记
   * @returns
   */
  isAtomComponentPath: (pathname: string) => boolean;

  /**
   * 是否需要标记元素
   * @param elementName
   * @returns
   */
  shouldTagElement: (elementName: string) => boolean;

  /**
   * 指定根目录，用于标记文件路径
   */
  root?: string;
};

declare const makeTagger: (options?: Partial<TaggerOptions>) => PluginOption;

declare const patchAfterUpdate: () => {
    name: string;
    resolveId(id: string): string;
    load(id: string): string;
    transformIndexHtml(html: string): {
        html: string;
        tags: {
            tag: string;
            attrs: {
                type: string;
                src: string;
            };
            injectTo: string;
        }[];
    };
};

/**
 * @file vite-plugin-monitor.ts
 * 使用 Sentry 官方 SDK 监控应用错误、性能和用户行为
 *
 * @created: 2025/12/02
 * @updated: 2025/12/05
 */

interface MonitorPluginOptions {
    /**
     * Sentry DSN (必填)
     */
    sentryDsn?: string;
    /**
     * 应用ID
     */
    appId?: string;
    /**
     * 环境标识
     */
    environment?: string;
    /**
     * Sentry SDK 版本
     * @default '7.119.0'
     */
    sentryVersion?: string;
    /**
     * 是否启用控制台日志捕获
     * @default true
     */
    enableConsoleCapture?: boolean;
    /**
     * 捕获的控制台日志级别
     * @default ['log', 'info', 'warn', 'error', 'debug', 'assert']
     */
    consoleLevels?: Array<'log' | 'info' | 'warn' | 'error' | 'debug' | 'assert'>;
    /**
     * 是否启用 HTTP 请求追踪
     * @default true
     */
    enableHttpTracing?: boolean;
    /**
     * 需要追踪的域名列表 (支持正则)
     * @default ['localhost', /^\//] - 本地和相对路径
     */
    tracingOrigins?: Array<string | RegExp>;
    /**
     * 是否在 Replay 中遮罩所有文本
     * @default false
     */
    maskAllText?: boolean;
    /**
     * 是否在 Replay 中屏蔽所有媒体
     * @default false
     */
    blockAllMedia?: boolean;
    /**
     * 自定义标签
     */
    tags?: Record<string, string>;
    /**
     * 发布版本
     */
    release?: string;
}
declare function monitorPlugin(options?: MonitorPluginOptions): Plugin;

type AppType = {
    appType?: 'web' | 'miniapp';
    cdnBase?: string;
};
declare function miaodaDevPlugin(options?: BorderStylePluginOptions & FontsCodePluginOptions & AppType): (vite.Plugin<any> | {
    name: string;
    enforce: string;
    buildStart(): void;
    transform(code: string, id: string): Promise<void>;
    configureServer(server: any): void;
} | {
    name: string;
    enforce: string;
    configResolved(resolvedConfig: any): void;
    transform(code: any, id: any): {
        code: string;
        map: any;
    };
})[];

export { type AppType, type BorderStylePluginOptions, type FontsCodePluginOptions, type MonitorPluginOptions, borderStylePlugin, dynamicRedirectPlugin, extractRouterPlugin, extractTaroRouterPlugin, fontsCodePlugin, injectDomainPlugin, injectOnErrorPlugin, injectedGuiListenerPlugin, replaceLocationPlugin as locationRoutePlugin, makeTagger, mdClickPlugin, miaodaDevPlugin, monitorPlugin, patchAfterUpdate };
